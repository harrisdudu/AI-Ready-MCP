concept_question_prompt = """
请根据以下文章内容生成合适数量的概念型问题（不要多于5个），不需过多生成，避免问题重复：
概念型问题 （通常以什么是...、...有哪些特征、...的核心原则是什么、如何定义...等句式开头，侧重于对专业概念的本质、属性和基本原则的阐释）”
规范性材料要求精准检索能力，提问以概念检索类为主（如定义、特征、原则等），回答内容零自由，需严格遵循原文，禁止任何形式的概括、转述或补充。
问题范围需要聚焦于文章内容中明确提出的核心专业概念、术语或原则（例如：‘城市更新’、‘合同生效’、‘行政处罚’）。问题应要求对文中明确表述的单一概念要点进行精准定位和完整复现，而非总结、分析或应用。
问题中**禁止**使用任何具体的法规、标准、图名、表名或文件名称。无需出现 ‘根据规范’， ‘根据文档’等表述。
严格避免出现重复问题或询问角度极其相似的问题。
问题主语需基于文档标题或内容补充完整定语（如当文件标题为‘厨房设备灭火装置’时，将问题中‘启动方式’修正为‘厨房设备灭火装置的启动方式’）
返回格式：问题中不能有多个问题，且问题被<Q></Q>包裹
<Q>Question1</Q>
<Q>Question2</Q>
<Q>Question3</Q>
...

正确例子：
<Q>什么是“闪燃”现象？</Q>
<Q>“防火分隔”应遵循哪些基本原则？</Q>
<Q>“爆炸极限”有哪些基本特征？</Q>


错误例子：
<Q>城市更新的具体审批流程是什么？</Q> （属于流程细节，非概念型，禁止）
<Q>GB50156-2002规范中规定的安全间距是多少？</Q> （包含标准名称和技术参数，禁止）
<Q>有哪些原则？</Q> （主语不具体，问题空泛）
<Q>文章提到了哪些概念？</Q> （属于事实提取，缺乏概念聚焦）

文件标题：
{title}

文章：
{content}

"""


concept_question_answer_prompt = """
#### 一、核心任务
基于提供的规范性材料（<reference_materials>），对输入的问题进行严格筛选与回答。仅处理符合“概念型问题”定义（询问概念的定义、特征、属性、原则、核心要素）且能从材料中找到**直接、完整、明确**对应答案的问题；不符合要求的问题需拒绝回答，并说明理由。

#### 二、问题筛选标准（拒绝回答条件）
若遇到以下任一情况，请拒绝回答：
1.  **问题类型不符**：问题不属于概念型问题（如涉及具体操作流程、技术参数、责任主体划分、案例细节、方案设计等）。
2.  **内容未提及**：问题所询问的概念或其定义、特征、原则等在<reference_materials>中完全未提及。
3.  **表述空泛或前提错误**：问题主语不明确，或问题的前提假设与材料中的事实相悖。
4.  **需整合推导**：答案需要总结、合并、推导原文中多处分散的内容才能形成。

#### 三、回答要求（符合筛选标准的问题）
1.  **零自由原则**：
    -   答案必须严格、逐字地源自<reference_materials>原文，禁止任何形式的概括、转述、补充或使用“等”、“之类”的省略。
    -   答案的表述逻辑、分点结构、标点符号必须与原文保持完全一致。

2.  **信息自洽与明确引用**：
    -   答案必须让一个**没有看过<reference_materials>的用户**能完全理解。
    -   必须明确指出答案对应的**完整来源**（文档标题/规范名称 + 具体的章节/条款号）。首次提及须用全称，后续可使用明确简称（如“该规范”）。
    -   **绝对禁止**使用“原文”、“文中”、“上述条款”、“如第X条所述”等模糊指代。

#### 四、COT（思维链）要求
请严格按照以下三步结构组织你的推理过程，确保清晰、简洁：
**第一步：问题与材料分析**
【问题类型判断】：判断问题是否属于“概念型问题”（定义/特征/原则等）。
【关键概念定位】：提取问题中的核心概念。
【材料主题】：文档{title}的主旨是关于XXX的规范性文件。
【来源初步判断】：预期答案可能存在于规范中的哪个部分（如“总则”、“术语定义”章节）。

**第二步：原文定位与匹配**
【精确来源定位】：在<reference_materials>中定位到解答问题的具体章节和条款（例如：“第三章 基本原则 第3.2条”）。
【原文内容复现】：完整摘录该条款下的所有相关原文内容（不可简写）。
【匹配度确认】：确认摘录的原文内容是否直接、完整地回答了问题。

**第三步：答案构建确认**
【答案构成】：答案将完全由第二步中定位的原文内容构成。
【自洽性检查】：确认答案已包含所有必要信息，无需外部知识，且所有引用来源清晰明确。



#### 五、返回格式（严格遵循）
<Q>{question}</Q>
<COT>
第一步：问题与材料分析
【问题类型判断】：判断结果与理由
【关键概念定位】：核心概念
【材料主题】：文档主旨
【来源初步判断】：预期位置

第二步：原文定位与匹配
【精确来源定位】：具体章节/条款号
【原文内容复现】：完整摘录的原文
【匹配度确认】：确认结果

第三步：答案构建确认
【答案构成】：答案描述
【自洽性检查】：自洽性确认
</COT>
<A>根据《{title}》对应的具体章节/条款号：复述原文答案</A>

拒绝回答：
<Q>Question</Q>
<COT>拒绝的理由</COT>
<A>Reject</A>


#### 六、输入格式
我将以以下格式提供信息，请严格据此执行：
<title>
{title}
</title>

<question>
{question}
</question>

<reference_materials>
{content}
</reference_materials>

"""


book_question_prompt = """
请根据给定文章生成合适数量的分析型问题，问题不要有重复，不需要强行提问，根据实际知识密度进行提问：
分析型问题 （涉及业务中最需要评价的对象，分析对象作用、策略或涉及到一个事件的总结概述， 事件两面的对比）。
知识性材料要求逻辑推导能力，提问以分析类为主（如作用、策略等），回答内容适度自由，需要思维链，可以进行总结提炼。
问题范围需要覆盖到具体的对象，问题需要涉及一定的总结和分析，拒绝对概念定义或技术类（技术参数，技术细节）的询问。
问题中**禁止**使用任何具体的法规、标准、图名、表名或文件名称。无需出现 ‘根据规范’ 等表述。
问题主语需基于文档标题或内容补充完整定语（如当文件标题为‘厨房设备灭火装置’时，将问题中‘启动方式’修正为‘厨房设备灭火装置的启动方式’）
返回格式：问题中不能有多个问题，且问题被<Q></Q>包裹
<Q>Question1</Q>
<Q>Question2</Q>
<Q>Question3</Q>
...

例子：
<Q>曹杨环浜八项行动在提升社区公共空间品质方面起到了哪些关键作用？</Q>
<Q>桂巷坊更新项目如何通过设计策略实现社区商业活力空间的重塑？</Q>
<Q>曹杨新村“15分钟社区生活圈”建设中，多方协作机制对项目推进产生了怎样的影响？</Q>

文件标题：
{title}

文章：
{content}

"""


book_question_answer_prompt = """
筛选所提供的问题，确认是否能在具体条款章节中找到答案，问题本身是否符合原文
若找不到答案或问题不符合原文，或者问题部分缺失（如选择题缺失选项），请从遵循“拒绝回答”回复， COT部分给出拒绝理由，回答为Reject，代表问题被拒绝。
若符合条件，请按照返回格式返回。要求COT部分先列出论据所在的具体的条款章节再进行分析，给出具体条款章节和涉及的原文细节，禁用“原文”、 “文中”等模糊不清的说法；
在COT和回答中一律禁用“原文”、 “文中”等模糊不清的说法。

知识性材料要求逻辑推导能力，回答内容适度自由，需要思维链，可以进行总结提炼。

**Answer要求**：  
- 回答必须基于提供的<reference_materials>，但必须保证任何一个没有看到<reference_materials>的用户也能完全理解你的答案。这意味着你必须避免任何对<reference_materials>的间接指代。
   【核心规则】（必须遵守）
   1.  **信息自洽**：回答必须让**一个没有看过<reference_materials>的用户**也能完全理解。
   2.  **明确引用**：任何源自<reference_materials>的观点、条款、案例或数据，都必须明确指出其**完整来源**（规范名称、章节/条款号）。
   3.  **禁止模糊指代**：绝对禁止使用"上述条款"、"如案例所述"、"根据第三条"等模糊说法。

   【引用格式】当引用<reference_materials>中的内容时，你必须：
   1.  首先明确指出引用的来源名称，如果后续有再出现，**必须**通过括号说明后续简称,例如："根据《飞机库设计防火规范 GB50284-2008》总则第1.0.3条（后简称为《规范》），..."。
   2.  首次提及后，可简称为"该规范"或"《规范》"，但仍需说明条款号，如"该规范第3.0.1条要求..."。
   3.  对于案例，需说明案例出处，如"该规范在第三章的案例说明中，记载了1965年美国迈阿密机场的火灾案例..."。  

   【严格禁止】绝对不允许出现以下情况：
   -   **错误示例1（不指明来源）**： “如1.0.3指出的...”（❌ 用户不知道1.0.3是什么）
   -   **错误示例2（模糊指代）**： “根据第三条...”、“如案例所述...”（❌ 指向不明）
   -   **错误示例3（依赖隐藏上下文）**： “首都机场案例中的数据...”（❌ 必须说明这个案例出自提供的规范上下文）

返回格式：问题被<Q></Q>包裹(保证问题完整，不要缺失选项)，答案被<A></A>包裹，思维链被<COT></COT>包裹
<Q>Question</Q>
<COT>Chain of Thought</COT>
<A>Answer</A>

拒绝回答：
<Q>Question</Q>
<COT>拒绝的理由</COT>
<A>Reject</A>

# 输入格式
我将以以下格式提供信息，请严格据此执行：
<title>
{title}
</title>

<question>
{question}
</question>

<reference_materials>
{content}
</reference_materials>
"""



evaluate_prompt = """
你是一个QA评测助手，请基于以下标准严格评估QA对，并根据所给定义为QA对内容进行分类：

各标签详细定义与范例
1. 防火 
核心定义： 指在火灾发生之前，为了消除火灾隐患、降低火灾概率、确保人员疏散安全而进行的所有主动性、预防性工作和相关问题。其工作模式是“主动出击”。
关键词： 预防、检查、审批、宣传、教育、规划、风险评估、隐患整改。
典型应用场景与问题范例：
消防安全检查： 对企事业单位、公共场所、居民小区进行消防设施、安全通道、用火用电等的例行或专项检查。
建设工程消防审验： 对新建、改建、扩建工程的消防设计进行审核和竣工验收。
火灾隐患举报与整改： 处理公众关于堵塞消防通道、违规存放易燃易爆品等隐患的举报，并督促责任方整改。
消防宣传教育： 组织消防知识进社区、进学校、进企业活动，开展消防安全培训、疏散演练。
危险品管理： 对烟花爆竹、易燃易爆化学品的生产、储存、运输环节进行消防安全监管。
制定应急预案： 为重点单位制定火灾扑救和应急疏散预案。
2. 灭火 
核心定义： 指在火灾报警后，从接警出动到灭火救援行动结束全程中，所有以应对处置紧急事件为目标的工作和相关问题。其工作模式是“被动响应”。
关键词： 应急、响应、扑救、救援、处置、调度、战术、战评。
典型应用场景与问题范例：
接警与调度： 接收119火警电话，询问灾情信息，调派最近消防站和相应类型的消防车、人员出动。
火场扑救： 火灾现场的灭火战术展开（如内攻、外围控制、破拆、排烟、供水等）。
应急救援： 火场人员搜救、疏散、高空救援、交通事故救援（破拆救人）、危险化学品泄漏处置等。
火场指挥： 现场指挥体系的建立、通信保障、多部门（如公安、医疗）联动协调。
战评与总结： 火灾扑灭后，对救援过程进行复盘，分析成功经验和不足。
装备实战应用： 消防车、水枪、呼吸器等装备在火场中的使用效能和出现的问题。
3. 通用
核心定义： 指那些支撑“防火”与“灭火”两大体系正常运行的基础性、保障性工作和问题。它们通常不直接区分事前事后，而是为整个消防局的运作提供平台和支持。
关键词： 保障、管理、培训、维护、人事、后勤。
典型应用场景与问题范例：
队伍建设与培训： 消防员的招募、体能技能训练（既包括防火检查技能，也包括灭火救援技能）。
装备管理与维护： 消防车辆、器材、个人防护装备的采购、保养、维修、报废等全生命周期管理。
后勤保障： 消防站宿舍、食堂、车辆油料、被装等后勤事务。
信息技术系统： 消防业务系统、调度系统、数据库的维护和升级。
预算与财务： 申请年度预算，管理各项经费支出。
跨部门协作机制： 与应急管理、公安、医疗、水务、电力等部门建立的固定协作流程。
4. 无关
核心定义：完全与消防业务、消防知识、消防教材不相关的内容。只有完全不涉及消防领域的问题才标记为无关。
注意：任何与消防有关的内容，即使无法明确归类为防火、灭火，也应归为通用类别，而不是无关。
分析要求：
- 仔细阅读问题内容，理解其核心主题
- 首先判断是否与消防相关，完全无关的才标记为'无关'
- 对于消防相关问题，根据其主要关注点选择防火、灭火或通用
- 防火重点关注预防性措施，灭火重点关注应急响应，通用关注基础保障
输出格式：
请直接输出标签名称，只输出'防火'、'灭火'、'通用'或'无关'中的一个，不要添加其他内容。

评测标准：
1. 完整性（completeness）: 
   - 问题主语是否容易混淆，或者定义过于宽泛, 出现“该规范”， “原文” 这种模糊主语。
   - 问题中禁止使用具体的法规（文档标题）、标准、图名、表名或文件名称。
   - 答案需覆盖Reference中回答问题所需的所有核心信息点
   - 评分：0/1（不合格/合格）

2. 技术性（technical）:
   - 问题需涉及技术参数、适用条件或推导过程
   - 评分：0/1

3. 知识性（knowledge）:
   - 问题需涉及原理分析、策略或作用阐释
   - 评分：0/1

4. 准确性（correctness）:
   - 答案需严格基于Reference内容，无添加或虚构
   - 评分：0/1

5. 幻觉检测（hallucination）:
   - 答案中每句事实陈述必须能被Reference直接支持
   - 评分：0/1（存在任意幻觉即0分）

6. 难度（difficulty）:
   - 根据问题复杂度和所需推理深度评分（1-5分）
   - 若答案可直接从问题(并非REF)中推导则计0分

7. 问题类别(category):
   - 根据问题所陈述的内容/主题判断QA对的类别
   - 分类：(防火/灭火/通用/无关)   

返回格式（JSON）：
{{
    "reason": "简要综述优缺点，问题分类依据，重点说明主语完整性、覆盖率及幻觉问题",
    "completeness": 0,
    "technical": 0,
    "knowledge": 0,
    "correctness": 0,
    "hallucination": 0,
    "difficulty": 0,
    "category": "防火/灭火/通用/无关 四选一"
}}

输入：
{QA_pair}
"""

evaluate_prompt_common = """
你是一个QA评测助手，请基于以下标准严格评估QA对，并根据所给定义为QA对内容进行分类：

1. 完整性与清晰性 (Completeness & Clarity) | 分值: 0-5
评估问题和答案是否完整、自洽，且表述清晰无歧义。
-- 5 (优秀): 问题主语明确具体，无任何模糊或宽泛指代。答案全面覆盖了Reference中所有核心信息点，并进行了有机整合，形成了逻辑闭环。
-- 4 (良好): 问题主语明确，答案覆盖了大部分核心信息点，可能遗漏个别次要细节，但整体完整。
-- 3 (一般): 问题主语基本明确，但答案仅覆盖了部分核心信息，存在明显遗漏，或信息罗列缺乏整合。
-- 2 (较差): 问题主语略显宽泛（如“如何防火”），或答案仅涉及零散信息，缺乏完整性。
-- 1 (很差): 问题主语模糊不清，或答案严重遗漏核心信息。
-- 0 (不合格): 问题中包含了被禁止的具体法规、标准、图名、表名或文件名称。或答案完全未回答提出的问题。

2. 技术深度 (Technical Depth) | 分值: 0-5
评估问题是否触及技术核心，以及答案是否体现了必要的技术细节和推导过程。
-- 5 (优秀): 问题深入到技术参数、适用条件、工作原理或不同技术方案的比较。答案清晰地阐述了技术选型理由、参数依据或逻辑推导链条。
-- 4 (良好): 问题涉及技术应用场景或条件，答案解释了技术措施背后的原因或逻辑。
-- 3 (一般): 问题仅询问具体措施或方法，答案正确但仅止步于“怎么做”，未深入解释“为何这么做”。
-- 2 (较差): 问题偏向于一般性管理或操作流程，技术含量较低。
-- 1 (很差): 问题几乎不涉及任何技术细节。
-- 0 (不合格): 问题与技术无关。

3. 知识性与分析性 (Knowledge & Analysis) | 分值: 0-5
评估问题是否要求阐释、分析、评价，以及答案是否体现了对知识的提炼和总结能力。
-- 5 (优秀): 问题要求分析原因、评价策略有效性、阐述重要性或对比优劣。答案基于Reference进行了高度的总结提炼，形成了有深度的分析性论述。
-- 4 (良好): 问题要求解释原理或作用，答案进行了有效的归纳和阐释。
-- 3 (一般): 问题要求列举措施或办法，答案正确列举但分析性较弱。
-- 2 (较差): 问题偏向于事实性询问，答案仅为简单的信息复述。
-- 1 (很差): 问题几乎不需要任何分析性思维。
-- 0 (不合格): 问题属于纯粹的概念定义型（如“什么是XX？”），为禁止类型。

4. 准确性与引用透明性 (Accuracy & Citation Transparency) | 分值: 0-5
评估答案是否严格基于原文，且任何引用对未读原文的用户而言都是清晰透明的。
-- 5 (优秀): 答案绝对忠实于Reference，无任何添加或虚构。所有源自原文的观点、案例、数据都以自洽的方式清晰地融入了答案（例如：“例如，CNG储气瓶的防腐应...，正如四川绵阳事故所警示的那样，因脱水不净导致钢瓶腐蚀爆炸...”）。答案完全独立，无需任何背景信息即可理解。
-- 4 (良好): 答案内容准确，但个别地方的表述略显生硬，或可更流畅地融入上下文。答案对于条文条款数量引用正确并**完整**。
-- 3 (一般): 答案内容基本准确，但存在轻微的“引用不透明”（Opaque Citation）或“上下文依赖”（Context-Dependence），例如使用了“上述措施”等模糊指代，但结合上下文仍可推断。
-- 2 (较差): 答案存在个别不准确的表述，或有多处模糊指代，影响理解，答案存在引用不全，原文中涉及到的法文条款没有全部引用，而是使用 “等” 字眼进行省略。
-- 1 (很差): 答案虽然部分基于原文，但掺杂了明显的外部知识或错误解读，引用非常不透明。答案存在引用不全，原文中涉及到的法文条款没有全部引用，而是使用 “等” 字眼进行省略。
-- 0 (不合格): 答案存在严重的事实性错误或完全捏造的内容，或严重依赖隐藏上下文（如直接使用“见条款3.2.1”而未说明来源）。答案存在引用不全，原文中涉及到的法文条款没有全部引用，而是使用 “等” 字眼进行省略。

5. 幻觉指数 (Hallucination Index) | 分值: 0* 或 5*
(*本项为否决项，通常只计0或5分)
评估答案中事实性陈述的可验证性。
-- 5 (无幻觉): 答案中的每一句事实性陈述都能在Reference中找到直接或合理推导的支持。
-- 0 (存在幻觉): 答案中出现了至少一句Reference中完全未提及、且无法通过文中信息合理推导出的事实性信息。存在幻觉即计0分。

6. 难度与推理深度 (Difficulty & Reasoning Depth) | 分值: 1-5
评估问题本身的复杂度和回答所需进行的推理深度。
-- 5 (极高): 问题复杂，需要综合Reference中多个部分的信息，进行对比、分析、评价或多步推导才能解答。
-- 4 (高): 问题需要整合不同段落的信息，并进行归纳和总结。
-- 3 (中): 问题答案分布在Reference的相邻段落中，需要进行简单的关联和推理。
-- 2 (低): 问题答案明确集中在Reference的某一两句话中，仅需简单的 paraphrase（释义）即可回答。
-- 1 (极低): 问题答案几乎可以直接从问题本身或Reference的某句话中原样复制，几乎不需要推理。若答案可直接从问题(并非REF)中推导则计0分。

**各标签详细定义与范例**
1. 防火 
核心定义： 指在火灾发生之前，为了消除火灾隐患、降低火灾概率、确保人员疏散安全而进行的所有主动性、预防性工作和相关问题。其工作模式是“主动出击”。
关键词： 预防、检查、审批、宣传、教育、规划、风险评估、隐患整改。
典型应用场景与问题范例：
消防安全检查： 对企事业单位、公共场所、居民小区进行消防设施、安全通道、用火用电等的例行或专项检查。
建设工程消防审验： 对新建、改建、扩建工程的消防设计进行审核和竣工验收。
火灾隐患举报与整改： 处理公众关于堵塞消防通道、违规存放易燃易爆品等隐患的举报，并督促责任方整改。
消防宣传教育： 组织消防知识进社区、进学校、进企业活动，开展消防安全培训、疏散演练。
危险品管理： 对烟花爆竹、易燃易爆化学品的生产、储存、运输环节进行消防安全监管。
制定应急预案： 为重点单位制定火灾扑救和应急疏散预案。
2. 灭火 
核心定义： 指在火灾报警后，从接警出动到灭火救援行动结束全程中，所有以应对处置紧急事件为目标的工作和相关问题。其工作模式是“被动响应”。
关键词： 应急、响应、扑救、救援、处置、调度、战术、战评。
典型应用场景与问题范例：
接警与调度： 接收119火警电话，询问灾情信息，调派最近消防站和相应类型的消防车、人员出动。
火场扑救： 火灾现场的灭火战术展开（如内攻、外围控制、破拆、排烟、供水等）。
应急救援： 火场人员搜救、疏散、高空救援、交通事故救援（破拆救人）、危险化学品泄漏处置等。
火场指挥： 现场指挥体系的建立、通信保障、多部门（如公安、医疗）联动协调。
战评与总结： 火灾扑灭后，对救援过程进行复盘，分析成功经验和不足。
装备实战应用： 消防车、水枪、呼吸器等装备在火场中的使用效能和出现的问题。
3. 通用
核心定义： 指那些支撑“防火”与“灭火”两大体系正常运行的基础性、保障性工作和问题。它们通常不直接区分事前事后，而是为整个消防局的运作提供平台和支持。
关键词： 保障、管理、培训、维护、人事、后勤。
典型应用场景与问题范例：
队伍建设与培训： 消防员的招募、体能技能训练（既包括防火检查技能，也包括灭火救援技能）。
装备管理与维护： 消防车辆、器材、个人防护装备的采购、保养、维修、报废等全生命周期管理。
后勤保障： 消防站宿舍、食堂、车辆油料、被装等后勤事务。
信息技术系统： 消防业务系统、调度系统、数据库的维护和升级。
预算与财务： 申请年度预算，管理各项经费支出。
跨部门协作机制： 与应急管理、公安、医疗、水务、电力等部门建立的固定协作流程。
4. 无关
核心定义：完全与消防业务、消防知识、消防教材不相关的内容。只有完全不涉及消防领域的问题才标记为无关。
注意：任何与消防有关的内容，即使无法明确归类为防火、灭火，也应归为通用类别，而不是无关。
分析要求：
- 仔细阅读问题内容，理解其核心主题
- 首先判断是否与消防相关，完全无关的才标记为'无关'
- 对于消防相关问题，根据其主要关注点选择防火、灭火或通用
- 防火重点关注预防性措施，灭火重点关注应急响应，通用关注基础保障
输出格式：
请直接输出标签名称，只输出'防火'、'灭火'、'通用'或'无关'中的一个，不要添加其他内容。

返回格式（JSON）：
{{
    "reason": "简要综述优缺点，问题分类依据，重点说明主语完整性、覆盖率及幻觉问题",
    "Completeness & Clarity": 0,
    "Technical Depth": 0,
    "Knowledge & Analysis": 0,
    "Accuracy & Citation Transparency": 0,
    "Hallucination Index": 0,
    "Difficulty & Reasoning Depth": 0,
    "Category": "防火/灭火/通用/无关 四选一"，
}}

输入：
{QA_pair}
"""


##################################################################################################################################

application_question_prompt = """
请根据以下文章内容生成合适数量的应用型问题（不要多于5个），不需过多生成，避免问题重复：
应用型问题 （通常以如何解决...问题、应采取哪些措施...、请设计一个方案来...、针对...情况，应如何整改等句式开头，侧重于实践和操作）”
知识性材料要求逻辑推导能力，提问以应用类为主（如解决办法、策略等），回答内容适度自由，需要思维链，可以进行总结提炼。
问题范围需要覆盖到具体的对象，问题需要涉及一定的总结和分析，拒绝对概念定义或技术类（技术参数，技术细节）的询问。
问题必须聚焦于文章内容中提到的具体实体、现象、工艺或场景（例如：‘CNG储气瓶组’、‘三合一厂房的疏散通道’、‘120#溶剂汽油的输送管道’）。问题应要求对文中的多个要点进行归纳、总结和逻辑推导，而非简单复述。
问题中**禁止**使用任何具体的法规、标准、图名、表名或文件名称。无需出现 ‘根据规范’， ‘根据文档’等表述。
严格避免出现重复问题的情况，例如"分析“三吧”“六小”场所火灾隐患整改复杂性、反复性突出的原因有哪些？"与"分析“三吧”“六小”场所火灾隐患整改复杂性、反复性突出的主要原因？"是同一种问题，不需重复提出。
问题主语需基于文档标题或内容补充完整定语（如当文件标题为‘厨房油锅装置’时，将问题中‘灭火方式’修正为‘厨房油锅装置的灭火方式’）
返回格式：问题中不能有多个问题，且问题被<Q></Q>包裹
<Q>Question1</Q>
<Q>Question2</Q>
<Q>Question3</Q>
...

正确例子：
<Q>请分析CNG加气站的主要火灾危险性有哪些？</Q>
<Q>如果一个‘三合一’厂房存在电线乱拉乱接、无消防设施，应如何整改？</Q>
<Q>在爆炸性粉尘环境中，为什么不能选用气体防爆设备？</Q>

错误例子：
<Q>什么是爆炸极限？</Q> （属于概念型问题，禁止）
<Q>GB50156-2002规范规定的间距是多少？</Q> （包含标准名称和技术参数，禁止）
<Q>如何防火？</Q> （主语不具体，问题空泛）
<Q>文章提到了哪些措施？</Q> （属于事实提取，缺乏分析和应用）

文件标题：
{title}

文章：
{content}

"""

application_question_answer_prompt = """
**拒绝回答标准**（满足以下任意一条即应拒绝）:
问题超纲：问题所问的内容在<reference_materials>中完全未提及。
问题类型不符：问题属于概念定义、技术参数查询、标准名称询问等被禁止的类型。
问题表述空泛：问题主语不明确，无法从材料中找到具体对应的分析对象。
问题基于错误前提：问题的前提假设与材料中的事实相悖。
筛选所提供的问题，确认是否能在文章中找到答案，问题本身是否符合原文描述
若符合**拒绝回答标准**，请从遵循“拒绝回答”回复， COT部分给出拒绝理由，回答为Reject，代表问题被拒绝。


若符合条件，请按照返回格式返回。要求COT部分先引用文章论据再进行分析；
在COT和回答中一律禁用“原文”、 “文中”等模糊不清的说法。

知识性材料要求逻辑推导能力，回答内容适度自由，需要思维链，可以进行总结提炼。

**Answer要求**：  
- 回答必须基于提供的<reference_materials>，但必须保证任何一个没有看到<reference_materials>的用户也能完全理解你的答案。这意味着你必须避免任何对<reference_materials>的间接指代。
   【核心规则】（必须遵守）
   1.  **禁止假信息**：回答必须出自原文内容或基于绝对真实的信息，禁止篡改，捏造现象出现。
   2.  **信息自洽**：回答必须让**一个没有看过<reference_materials>的用户**也能完全理解。
   3.  **明确引用**：任何源自<reference_materials>的观点、条款、案例或数据，都必须明确指出其**完整来源**。
   4.  **禁止模糊指代**：绝对禁止使用"上述条款"、"如案例所述"、"根据第三条"等模糊说法。
   5.  **整合性**：答案必须是对原文信息的深度整合与提炼，用流畅的逻辑重新组织语言，形成一段完整的、有因果关系的论述。
   6.  **前后条件完整**： 在阐述某一措施或方法时，必须同时说明其所有适用前提、限制条件或例外情况，确保逻辑严谨性。例如，在说明“可实施主动点燃”时，必须同时说明其先决条件（如“现场气体扩散未达到一定范围”）。

**COT（思维链）要求**：  
请按照以下三步结构组织你的推理过程，确保简洁明了,并且每一步自动分段：
**第一步**
【材料引用】：出自【{title}】页面，指明信息出处
【核心询问】：用一句话提炼问题核心
【关键实体】：列出问题中的关键对象
【材料主题】：文档标题，主要内容是关于用一句话概括材料主旨
【相关度】：【高度相关/部分相关/无关】

**第二步**
【核心信息定位】：
"原文关键句段1" → 简要概括信息点A
"原文关键句段2" → 简要概括信息点B
【信息点关系】：【因果/递进/并列/措施与目的】
【推导逻辑】：简要说明从信息点到答案的推理链条

**第三步**
【答案框架】：先说明X，再阐述Y，最后总结Z
【自洽确认】：答案完全基于上述引用信息整合，无外部添加内容，且避免使用"上述"、"文中"等指代性词汇，确保独立可读

返回格式：问题被<Q></Q>包裹(保证问题完整，不要缺失选项)，答案被<A></A>包裹，思维链被<COT></COT>包裹
<Q>Question</Q>
<COT>Chain of Thought</COT>
<A>Answer</A>

拒绝回答：
<Q>Question</Q>
<COT>拒绝的理由</COT>
<A>Reject</A>

# 输入格式
我将以以下格式提供信息，请严格据此执行：
<title>
{title}
</title>

<question>
{question}
</question>

<reference_materials>
{content}
</reference_materials>
"""


#####################################################################################################################
# 在 prompts.py 中添加以下提示词

question_type_judgment_prompt = """
请判断以下文本段落最适合生成哪种类型的问题（可以多选）：
1. 应用型：适合解决实际问题、设计方案、技术应用等
2. 分析型：适合分析原因、评价策略、比较优劣等
3. 概念型：适合提取定义、特征、原则等基础概念

请返回适合的类型名称，多个类型用逗号分隔（例如：分析型,应用型），**不要添加其他内容**。

文本内容：
{content}
"""

# 概念型问题的上下文扩展提示词
concept_context_prompt = """
请基于以下文本内容生成问题，并使用上下各500词作为参考上下文（防止内容截断）。
要求必须从参考上下文中寻找答案。

"""

# 分析型问题的上下文扩展提示词
analysis_context_prompt = """
请基于以下文本内容生成问题，并使用上下各1000词作为参考上下文（防止内容截断）。
要求必须从参考上下文中寻找答案。

"""

# 应用型问题的上下文扩展提示词
application_context_prompt = """
请基于以下文本内容生成问题，并使用上500词、下1500词作为参考上下文（防止内容截断）。
要求必须从参考上下文中寻找答案。

"""
