# 医院数据表关系分析报告

## 表关系概述 📊

基于提供的9个医院数据表结构，我分析了各表之间的主键关联和潜在的外键关系。这些表主要分为几个数据域：电子病历(EMR)、检验(LAB)、医学影像(OBS)、患者主索引(MDM)和病案(MR)。

## 各表主键及关联关系详解 🔗

### 1. 电子病历域 (EMR)

**EMR_DocList**
- 主键：`DocID`
- 主要功能：存储电子病历文档的基本信息
- 关键字段：`DocID`, `VisitNumber`, `PatientID`, `DocTypeCode`

**EMR_DocSectionList**
- 主键：`ID`
- 外键关联：`DocID` (关联到 EMR_DocList.DocID)
- 主要功能：存储电子病历文档的各个章节内容
- 关键字段：`ID`, `DocID`, `SectionCode`, `SectionContent`

### 2. 检验域 (LAB)

**Lab_OBR**
- 主键：`FillerOrderNo`
- 主要功能：存储检验申请单信息
- 关键字段：`FillerOrderNo`, `VisitNumber`, `PatientID`, `UniversalServiceID`

**Lab_OBX**
- 主键：复合键 `(FillerOrderNo, SetID)`
- 外键关联：`FillerOrderNo` (关联到 Lab_OBR.FillerOrderNo)
- 主要功能：存储检验结果明细
- 关键字段：`FillerOrderNo`, `SetID`, `ObservationID`, `ObservationValue`

### 3. 医学影像域 (OBS)

**OBS_Report**
- 主键：复合键 `(FillerOrderNo, ReportID, ClassID)`
- 主要功能：存储医学影像报告信息
- 关键字段：`FillerOrderNo`, `ReportID`, `ClassID`, `PatientID`, `VisitNumber`

**OBS_ReportImageList**
- 主键：复合键 `(FillerOrderNo, ClassID, ImageNo)`
- 外键关联：`FillerOrderNo`, `ClassID` (关联到 OBS_Report.FillerOrderNo, OBS_Report.ClassID)
- 主要功能：存储医学影像列表
- 关键字段：`FillerOrderNo`, `ClassID`, `ImageNo`, `PatientID`, `VisitNumber`

**OBS_ReportImageListSub**
- 主键：复合键 `(FillerOrderNo, ClassID, ImageNo, SequenceNo)`
- 外键关联：`FillerOrderNo`, `ClassID`, `ImageNo` (关联到 OBS_ReportImageList 对应字段)
- 主要功能：存储医学影像的子项信息
- 关键字段：`FillerOrderNo`, `ClassID`, `ImageNo`, `SequenceNo`

### 4. 患者主索引域 (MDM)

**MDM_EMPI_VisitNumber**
- 主键：复合键 `(CDRVisitNumber, PatientClass, HospitalCode)`
- 主要功能：关联患者主索引与就诊号
- 关键字段：`CDRVisitNumber`, `PatientClass`, `EmpiDisplayID`, `HospitalCode`

### 5. 病案域 (MR)

**MR_MedicalRecord**
- 主键：`MRN` (Medical Record Number)
- 主要功能：存储患者的病案首页信息
- 关键字段：`MRN`, `PatientID`, `VisitNumber`, `AdmissionDate`, `DischargeDate`

## 跨域关联字段 🌐

几个重要的跨域关联字段：

| 字段名 | 涉及表 | 作用 |
|-------|-------|------|
| `VisitNumber` | EMR_DocList, MR_MedicalRecord, Lab_OBR, MDM_EMPI_VisitNumber, OBS_ReportImageList | 就诊号，连接患者在一次就诊期间的所有记录 |
| `PatientID` | EMR_DocList, MR_MedicalRecord, Lab_OBR, OBS_Report, OBS_ReportImageList | 患者ID，标识患者身份 |
| `FillerOrderNo` | Lab_OBR, Lab_OBX, OBS_Report, OBS_ReportImageList, OBS_ReportImageListSub | 申请单号，连接申请与结果 |
| `ClassID` | OBS_Report, OBS_ReportImageList, OBS_ReportImageListSub | 类型ID，标识影像类型 |

## 数据库关系图结构 🗺️

整体关系可以概括为：

1. **患者主索引层**：MDM_EMPI_VisitNumber 作为患者身份的核心关联
2. **就诊层**：MR_MedicalRecord 记录患者每次就诊的基本信息
3. **业务数据层**：
   - EMR：EMR_DocList → EMR_DocSectionList (一对多)
   - LAB：Lab_OBR → Lab_OBX (一对多)
   - OBS：OBS_Report → OBS_ReportImageList → OBS_ReportImageListSub (一对多，再一对多)
4. **跨业务关联**：通过 VisitNumber 和 PatientID 在各业务数据间建立横向关联

## 总结 📝

这些表构成了一个完整的医院临床数据仓库(CDR)，通过主键和外键关系形成了层次分明的数据模型。这种设计支持了从患者身份识别到具体诊疗记录的全方位数据管理，便于临床查询、统计分析和科研使用。

值得注意的是，虽然部分外键关系在物理结构上可能没有显式定义约束，但在逻辑上通过上述关键字段建立了明确的关联关系。